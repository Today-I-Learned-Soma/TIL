## 오늘 배운 것

---

## ALB 기능

- Sticky
    - 사용자가 한 번 접속한 적이 있는 서버를 기억해두고 커넥션이 사라진 상태에서 사용자가 다시 접속하더라도 기존 커넥션이 있었던 서버로 연결해주는 기능
    - 쿠키를 이용하여 스티키를 지원

## 도커

- 도커를 사용하면 OS환경설정, 언어, 라이브러리 등이 설치된 환경을 그대로 이미지로 빌드가 가능하다.
- EC2인스턴스에는 미리 도커라이징된 이미지를 다운로드 받고 도커를 통해 실행하기만 하면 된다.
- Dockerfile
    - 도커 이미지를 빌드하기 위한 스크립트 파일
    - 순차적으로 명령을 실행하여 이미지를 빌드
    

## 보안그룹

- 22번 포트
    - AWS EC2에 터미널로 접속하기 위해 열어둠(SSH)
    - 지정된 IP에서만 접속이 가능하도록 해야 함
        - 내 IP를 선택하면 현재 접속한 장소의 IP가 자동지정
        - 만약 집 외의 다른 장소에서 접속 시 `해당 장소의 IP를 SSH 규칙에 추가`해야함

### *탄력적 IP는 EC2에 연결하지 않으면 비용이 발생*

## 도커(Docker)

- 암시적 볼륨
    - 컨테이너 삭제 시 함께 삭제
        - 명시적으로 볼륨을 생성하여 마운팅을 해주면 영구적으로 데이터 보존 가능
- 명시적 볼륨

```bash
docker run -d --name mysql-container -p 3306:3306 (외부:내부)
-v mysql-volume:/var/lib/mysql 
-e MYSQL_ROOT_PASSWORD=1234 mysql:latest
```

name : mysql-container라는 이름의 컨테이너 생성

-p : 3306포트를 컨테이너의 3306포트와 포트포워딩(외부→ 내부)

-v : 호스트의 mysql-volume의 volume과 컨테이너의 /var/lib/mysql volume을 마운팅

-e : MYSQL_ROOT_PASSWORD 환경변수 값을 1234로 지정

-d : daemon으로 실행

## 서버 아키텍처

---

아무도 사용 안했을 때 → 오래된 순

- 알림은 생각 안해봄
    - 순서가 중요하지 않은 서비스들은
    - SQS같은걸 써가지고
- api서버가 하는 역할이 많아지면 부하가 생기게 된다.
    - 요청이 많아졌을 경우 autoscaling →
    
    api 
    
    cloudwatch가 오토스케일링을 해준다. →불필요한 부분도 
    
    ELB
    
    - 부하가 없을 때 분산처리를 해주는 것

3D 모델은 EC2위에 올리는게 맞다 → 너무 사이즈가 커지기 때문이다.

람다의 장점이 → 자기가 알아서 autoscaling 

api gateway역할을 하니까 람다를 쓰는 것이 좋다.

서버리스로 할꺼면 서버리스로 하구 

람다를 EC2 → 트리거를 해서 람다를 호출할 수 있다.

진짜 서버리스로 할 때만 API 

도면생성 서비스를 따로 EC2로 파야 한다. → 중간에 람다가 매개체 역할을 해서 

1. SQS가 받기만하고 받을 때 SQS에 트리거 된 람다가 호출이 되서 서비스로 전달을 해주는 것이다.
    1. 모델 생성을 
2. 3D 모델 생성 서버가 있을 때 그 서버가 SQS를 계속 롱폴링 하면서 메시지가 들어오면 그걸 가져간다.
    1. 그걸 가져가고 처리하고 SQS에서 지워주고
    2. 서버가 계속 while True로 확인
    3. 목서버를 만들었다 → 테스트 하기 위한
    
    - 읽는 성능때문에 Redis를 쓴ㄷ.
    
    큐 혹은 로드밸런서를 쓴다.
    
    모델이랑 큐랑 롱 폴링으로 통신을 한다.
    
    저장 끝나면 람다를 통해 트리거 해서 api 서버한테 알려주고 클라이언트에게 알려준다
    

## 오늘 느낀 것

---

- 시간이 너~~~무 빠르게 흐른다 오늘 그래도 은근 공부 많이 했다고 생각했는데 막상 지금와서 보니 한건 별로 없는 기분..
- 내일은 아침부터 카페가서 열공할것이다!

오늘 한일

- 젠킨스 도커라이징해서 올림 → 아직 설정은 못함
- mysql 도커라이징 해서 올림 → 아직 스프링에 적용은 못함

## 내일 할 일

---

- [ ]  S3 생성
- [ ]  mock객체 만들기
- [ ]  ALB 구성하기
- [ ]  도메인주도개발 참조해서 mvc모델 구성하기
- [ ]  스프링 회의